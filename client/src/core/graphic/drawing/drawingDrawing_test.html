<!DOCTYPE html>
<html>
<head>
<title>XRX++ Unit Tests - xrx.drawing.Drawing</title>
<script src='../../../../lib/closure-library/closure/goog/base.js'></script>
<script src='../../../deps.js'></script>
<script type="text/javascript">
  goog.require('goog.testing.jsunit');
  goog.require('goog.dom.DomHelper');
  goog.require('goog.style');
  goog.require('goog.userAgent');
  goog.require('xrx');
</script>
<style>
.drawing {
  display: block;
  width: 150px;
  height: 150px;
  border: solid grey 1px;
}
#backgroundTest {
  display: block;
  
}
#canvasBackground,
#svgBackground,
#vmlBackground {
  width: 200px;
  height: 200px;
  border: 4px solid grey;
  background-color: #E8FAE8;
  margin: 10px;
}
</style>
</head>
<body>

<table>
  <tr>
    <td></td>
    <td>Drawing</td>
	  <td>Set Background Image</td>
	  <td>Add Shapes</td>
  </tr>
  <tr>
	  <td>Canvas</td>
	  <td><div id="canvasDrawing" class="drawing"></div></td>
    <td><div id="canvasBackgroundImage" class="drawing"></div></td>
    <td><div id="canvasAddShapes" class="drawing"></div></td>
  </tr>
  <tr>
    <td>SVG</td>
    <td><div id="svgDrawing" class="drawing"></div></td>
    <td><div id="svgBackgroundImage" class="drawing"></div></td>
    <td><div id="svgAddShapes" class="drawing"></div></td>
  </tr>
  <tr>
	  <td>VML</td>
	  <td><div id="vmlDrawing" class="drawing"></div></td>
    <td><div id="vmlBackgroundImage" class="drawing"></div></td>
    <td><div id="vmlAddShapes" class="drawing"></div></td>
  </tr>
</table>

<div id="backgroundTest">
  <h2>Background Color Test</h2>
  <div>The examples should all show the same green background, i.e., the
    HTMLCanvas, SVGElement and VMLElement background color should not overdraw
    the background color of the drawing div.</div>
  <h3>Canvas</h3>
  <div id="canvasBackground"></div>
  <h3>SVG</h3>
  <div id="svgBackground"></div>
  <h3>VML</h3>
  <div id="vmlBackground"></div>
</div>

<script type="text/javascript">



function getDrawingCanvas(id) {
  var canvasDiv = goog.dom.getElement(id);
  return new xrx.drawing.Drawing(canvasDiv,
    xrx.engine.CANVAS);
};



function getDrawingSvg(id) {
  var svgDiv = goog.dom.getElement(id);
  return new xrx.drawing.Drawing(svgDiv,
      xrx.engine.SVG);
};



function getDrawingVml(id) {
  var vmlDiv = goog.dom.getElement(id);
  return new xrx.drawing.Drawing(vmlDiv,
      xrx.engine.VML, true);
};



function test1drawing() {
  if (!xrx.engine.isOldIE()) {
    var canvasDrawing = getDrawingCanvas('canvasDrawing');
    var svgDrawing = getDrawingSvg('svgDrawing');

    // drawing size
    assertEquals(150, canvasDrawing.getElement().clientWidth);
    assertEquals(152, canvasDrawing.getElement().offsetWidth);
    assertEquals(150, svgDrawing.getElement().clientWidth);
    assertEquals(152, svgDrawing.getElement().offsetWidth);

    // canvas size
    var canvasEngineElement = canvasDrawing.getCanvas().getEngineElement().getElement();
    var svgEngineElement = svgDrawing.getCanvas().getEngineElement().getElement();
    assertEquals('150', canvasEngineElement.getAttribute('width'));
    assertEquals('150', canvasEngineElement.getAttribute('height'));
    assertEquals('150', svgEngineElement.getAttribute('width'));
    assertEquals('150', svgEngineElement.getAttribute('height'));
  } else {
    var vmlDrawing = getDrawingVml('vmlDrawing');
    // drawing size
    assertEquals(152, goog.style.getSize(vmlDrawing.getElement()).width);
    // canvas size
    assertEquals(150, goog.style.getSize(vmlDrawing.getCanvas().getElement()).width);
    assertEquals(150, goog.style.getSize(vmlDrawing.getCanvas().getElement()).height);
  }
};



function test2setBackgroundImage() {
  var url = './drawing_test.png';
  if (!xrx.engine.isOldIE()) {
    var canvasDrawing = getDrawingCanvas('canvasBackgroundImage');
    var svgDrawing = getDrawingSvg('svgBackgroundImage');
    canvasDrawing.setBackgroundImage(url, function() {
      canvasDrawing.draw();
    });
    svgDrawing.setBackgroundImage(url, function() {
      svgDrawing.draw();
    });
  }
  var vmlDrawing = getDrawingVml('vmlBackgroundImage');
  vmlDrawing.setBackgroundImage(url, function() {
    vmlDrawing.draw();
  });
};



function xtest3resize() {
};



function test4addShapes() {
  if (!xrx.engine.isOldIE()) {
    var canvasDrawing = getDrawingCanvas('canvasAddShapes');
    var canvasCanvas = canvasDrawing.getCanvas();
    var svgDrawing = getDrawingSvg('svgAddShapes');
    var svgCanvas = svgDrawing.getCanvas();

    var canvasRect1 = xrx.shape.Rect.create(canvasCanvas);
    canvasRect1.setCoords([[10,10],[100,10],[100,100],[10,100]]);
    var canvasRect2 = xrx.shape.Rect.create(canvasCanvas);
    canvasRect2.setCoords([[40,40],[140,40],[140,140],[40,140]]);

    canvasDrawing.getLayerShape().addShapes([canvasRect1, canvasRect2]);
    canvasDrawing.draw();

    var svgRect1 = xrx.shape.Rect.create(svgCanvas);
    svgRect1.setCoords([[10,10],[100,10],[100,100],[10,100]]);
    var svgRect2 = xrx.shape.Rect.create(svgCanvas);
    svgRect2.setCoords([[40,40],[140,40],[140,140],[40,140]]);

    svgDrawing.getLayerShape().addShapes([svgRect1, svgRect2]);
    svgDrawing.draw();
  }
  var vmlDrawing = getDrawingVml('vmlAddShapes');
  var vmlCanvas = vmlDrawing.getCanvas();

  var vmlRect1 = xrx.shape.Rect.create(vmlCanvas);
  vmlRect1.setCoords([[10,10],[100,10],[100,100],[10,100]]);
  var vmlRect2 = xrx.shape.Rect.create(vmlCanvas);
  vmlRect2.setCoords([[40,40],[140,40],[140,140],[40,140]]);

  vmlDrawing.getLayerShape().addShapes([vmlRect1, vmlRect2]);
  vmlDrawing.draw();
};



function test5background() {
  var url = './drawing_test.png';
  if (!xrx.engine.isOldIE()) {
    var canvasDrawing = getDrawingCanvas('canvasBackground');
    var svgDrawing = getDrawingSvg('svgBackground');
    canvasDrawing.setModeView();
    svgDrawing.setModeView();
    canvasDrawing.setBackgroundImage(url, function() {
      canvasDrawing.draw();
    });
    svgDrawing.setBackgroundImage(url, function() {
      svgDrawing.draw();
    });
  }
  var vmlDrawing = getDrawingVml('vmlBackground');
  vmlDrawing.setModeView();
  vmlDrawing.setBackgroundImage(url, function() {
    vmlDrawing.draw();
  });
};

</script>
</body>
</html>