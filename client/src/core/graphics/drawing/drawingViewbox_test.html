<!DOCTYPE html>
<html>
<head>
<title>XRX++ Unit Tests - xrx.drawing.Viewbox</title>
<script src='../../../../lib/closure-library/closure/goog/base.js'></script>
<script src='../../../deps.js'></script>
<script type="text/javascript">
  goog.require('goog.testing.jsunit');
  goog.require('goog.dom.DomHelper');
  goog.require('goog.events');
  goog.require('goog.events.EventType');
  goog.require('xrx.drawing.Drawing');
  goog.require('xrx.engine');
  goog.require('xrx.shape.Shapes');
</script>
<style>
.drawing {
  display: block;
  width: 150px;
  height: 150px;
  border: solid grey 1px;
}
</style>
</head>
<body>
<h1>Standard transformations</h1>
<table>
  <tr>
    <td></td>
    <td>Original</td>
	  <td>Transform</td>
    <td>Rotate Left</td>
    <td>Rotate Right</td>
	  <td>Zoom In</td>
	  <td>Zoom Out</td>
  </tr>
  <tr>
    <td>SVG</td>
    <td><div id="svgOriginal" class="drawing"></div></td>
    <td><div id="svgSetMatrix" class="drawing"></div></td>
    <td><div id="svgRotateLeft" class="drawing"></div></td>
    <td><div id="svgRotateRight" class="drawing"></div></td>
    <td><div id="svgZoomIn" class="drawing"></div></td>
    <td><div id="svgZoomOut" class="drawing"></div></td>
  </tr>
  <tr>
	<td>Canvas</td>
    <td><div id="canvasOriginal" class="drawing"></div></td>
	<td><div id="canvasSetMatrix" class="drawing"></div></td>
    <td><div id="canvasRotateLeft" class="drawing"></div></td>
    <td><div id="canvasRotateRight" class="drawing"></div></td>
    <td><div id="canvasZoomIn" class="drawing"></div></td>
    <td><div id="canvasZoomOut" class="drawing"></div></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td><span></span></td>
    <td><span>'N' points to west?</span></td>
    <td><span>'N' points to east?</span></td>
    <td><span>Zoom in 50%?</span></td>
    <td><span>Zoom out 50%?</span></td>
  </tr>
</table>

<h1>Dump and restore transformation matrix</h1>
<div id="dumpRestore"></div>

<h1>Rotate around an anchor point</h1>
<div id="rotate"></div>

<script type="text/javascript">
var url = './drawing_test.png';

function getDrawingSvg(id) {
  var svgDiv = goog.dom.getElement(id);
  var svgDrawing = new xrx.drawing.Drawing(svgDiv,
      xrx.engine.SVG);
  return svgDrawing;
};

function getDrawingCanvas(id, callback) {
  var canvasDiv = goog.dom.getElement(id);
  var canvasDrawing = new xrx.drawing.Drawing(canvasDiv,
    xrx.engine.CANVAS);
  return canvasDrawing;
};

function test0Original() {
  var svgDrawing = getDrawingSvg('svgOriginal');
  svgDrawing.setBackgroundImage(url);
  svgDrawing.draw();
  var canvasDrawing = getDrawingCanvas('canvasOriginal');
  canvasDrawing.setBackgroundImage(url);
  canvasDrawing.draw();
};

function test1Transform() {
  // TODO
  var svgDrawing = getDrawingSvg('svgSetMatrix');
  svgDrawing.setBackgroundImage(url, function() {
    //svgDrawing.getViewbox().transform();
    svgDrawing.draw();
  });
  var canvasDrawing = getDrawingCanvas('canvasSetMatrix');
  canvasDrawing.setBackgroundImage(url, function() {
    //canvasDrawing.getViewbox().transform();
    canvasDrawing.draw();
  });

};

function test2RotateLeft() {
  // TODO
  var svgDrawing = getDrawingSvg('svgRotateLeft');
  svgDrawing.setBackgroundImage(url, function() {
    svgDrawing.getViewbox().rotateLeft();
    svgDrawing.draw();
  });
  var canvasDrawing = getDrawingCanvas('canvasRotateLeft');
  canvasDrawing.setBackgroundImage(url, function() {
    canvasDrawing.getViewbox().rotateLeft();
    canvasDrawing.draw();
  });
};

function test3RotateRight() {
  var svgDrawing = getDrawingSvg('svgRotateRight');
  svgDrawing.setBackgroundImage(url, function() {
    svgDrawing.getViewbox().rotateRight();
    svgDrawing.draw();
  });
  var canvasDrawing = getDrawingCanvas('canvasRotateRight');
  canvasDrawing.setBackgroundImage(url, function() {
    canvasDrawing.getViewbox().rotateRight();
    canvasDrawing.draw();
  });
};

function test4ZoomIn() {
  var svgDrawing = getDrawingSvg('svgZoomIn');
  svgDrawing.setBackgroundImage(url, function() {
    for (var i = 0; i < 10; i++) { svgDrawing.getViewbox().zoomIn(); }
    svgDrawing.draw();
  });
  var canvasDrawing = getDrawingCanvas('canvasZoomIn');
  canvasDrawing.setBackgroundImage(url, function() {
    for (var i = 0; i < 10; i++) { canvasDrawing.getViewbox().zoomIn(); }
    canvasDrawing.draw();
  });
};

function test5ZoomOut() {
  var svgDrawing = getDrawingSvg('svgZoomOut');
  svgDrawing.setBackgroundImage(url, function() {
    for (var i = 0; i < 10; i++) { svgDrawing.getViewbox().zoomOut(); }
    svgDrawing.draw();
  });
  var canvasDrawing = getDrawingCanvas('canvasZoomOut');
  canvasDrawing.setBackgroundImage(url, function() {
    for (var i = 0; i < 10; i++) { canvasDrawing.getViewbox().zoomOut(); }
    canvasDrawing.draw();
  });
};

function test6ctmDumpRestore() {
  var dump;
  var canvas = new xrx.drawing.Drawing(goog.dom.getElement('dumpRestore'));
  canvas.setBackgroundImage(url, function() {
    dump = canvas.getViewbox().ctmDump();
    dump[0]++;
    dump[1]++;
    dump[2]++;
    dump[3]++;
    dump[4]++;
    dump[5]++;
    canvas.getViewbox().ctmRestore(dump);
    canvas.draw();
  });
};

function test7rotate() {
  var dump;
  var canvas = new xrx.drawing.Drawing(goog.dom.getElement('rotate'));
  canvas.setModeView();
  canvas.setBackgroundImage(url, function() {
    canvas.getViewbox().getCTM().translate(1000, 50);
    canvas.getViewbox().getCTM().scale(5, 5);
    canvas.getViewbox().rotate(40, 0, 0);
    canvas.draw();
  });
};

</script>

</body>
</html>