<!DOCTYPE html>
<html>
<head>
<title>XRX++ Unit Tests - xrx.drawing.Viewbox</title>
<script src='../../../../lib/closure-library/closure/goog/base.js'></script>
<script src='../../../deps.js'></script>
<script src='./drawingViewbox_test.js'></script>
<link rel="stylesheet" type="text/css" href="./drawingViewbox_test.css">
<script type="text/javascript">
  goog.require('goog.testing.jsunit');
  goog.require('goog.dom.DomHelper');
  goog.require('goog.dom.forms');
  goog.require('goog.events');
  goog.require('goog.events.EventType');
  goog.require('xrx');
</script>
</head>
<body>

<h1>Viewbox Events</h1>
<div class="wrapper1">
  <div class="drawing zoom" id="event1"></div>
  <div class="drawing zoom" id="event2"></div>
</div>

<h1>Rotate, respecting a fix-point</h1>
<div>
  <form id="frotate">
    <input type="radio" name="dir" value="C" checked>Center<br>
    <input type="radio" name="dir" value="NE">Northeast<br>
    <input type="radio" name="dir" value="SE">Southeast<br>
    <input type="radio" name="dir" value="SW">Southwest<br>
    <input type="radio" name="dir" value="NW">Northwest<br>
  </form>
  <div class="drawing" id="rotate"></div>
  <button id="brotateLeft">Rotate left</button>
  <button id="brotateRight">Rotate right</button>
</div>

<h1>Standard transformations</h1>
<table>
  <tr>
    <td></td>
    <td>Original</td>
	  <td>Transform</td>
    <td>Rotate Left</td>
    <td>Rotate Right</td>
  </tr>
  <tr>
    <td>SVG</td>
    <td><div id="svgOriginal" class="drawing"></div></td>
    <td><div id="svgSetMatrix" class="drawing"></div></td>
    <td><div id="svgRotateLeft" class="drawing"></div></td>
    <td><div id="svgRotateRight" class="drawing"></div></td>
  </tr>
  <tr>
	<td>Canvas</td>
    <td><div id="canvasOriginal" class="drawing"></div></td>
	  <td><div id="canvasSetMatrix" class="drawing"></div></td>
    <td><div id="canvasRotateLeft" class="drawing"></div></td>
    <td><div id="canvasRotateRight" class="drawing"></div></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td><span></span></td>
    <td><span>'N' points to west?</span></td>
    <td><span>'N' points to east?</span></td>
  </tr>
</table>

<h1>Fit to width and height</h1>
<div class="drawing" id="fit"></div>
<div>
  <button id="bfitToWidth">Fit to width</button>
  <button id="bfitToHeight">Fit to height</button>
  <button id="bfitToWidthHeight">Fit to width height</button>
  <button id="bfitTestRotate">Rotate</button>
</div>

<h1>Dump and restore transformation matrix</h1>
<div id="dumpRestore"></div>

<script type="text/javascript">



function test0Original() {
  var svgDrawing = getDrawingSvg('svgOriginal');
  svgDrawing.setBackgroundImage(url);
  svgDrawing.draw();
  var canvasDrawing = getDrawingCanvas('canvasOriginal');
  canvasDrawing.setBackgroundImage(url);
  canvasDrawing.draw();
};



function test1Transform() {
  // TODO
  var svgDrawing = getDrawingSvg('svgSetMatrix');
  svgDrawing.setBackgroundImage(url, function() {
    //svgDrawing.getViewbox().transform();
    svgDrawing.draw();
  });
  var canvasDrawing = getDrawingCanvas('canvasSetMatrix');
  canvasDrawing.setBackgroundImage(url, function() {
    //canvasDrawing.getViewbox().transform();
    canvasDrawing.draw();
  });

};



function test2RotateLeft() {
  // TODO
  var svgDrawing = getDrawingSvg('svgRotateLeft');
  svgDrawing.setBackgroundImage(url, function() {
    svgDrawing.getViewbox().rotateLeft();
    svgDrawing.draw();
  });
  var canvasDrawing = getDrawingCanvas('canvasRotateLeft');
  canvasDrawing.setBackgroundImage(url, function() {
    canvasDrawing.getViewbox().rotateLeft();
    canvasDrawing.draw();
  });
};



function test3RotateRight() {
  var svgDrawing = getDrawingSvg('svgRotateRight');
  svgDrawing.setBackgroundImage(url, function() {
    svgDrawing.getViewbox().rotateRight();
    svgDrawing.draw();
  });
  var canvasDrawing = getDrawingCanvas('canvasRotateRight');
  canvasDrawing.setBackgroundImage(url, function() {
    canvasDrawing.getViewbox().rotateRight();
    canvasDrawing.draw();
  });
};



function test6fit() {
  var canvas = new xrx.drawing.Drawing(goog.dom.getElement('fit'));
  // buttons
  var fitToWidth = goog.dom.getElement('bfitToWidth');
  var fitToHeight = goog.dom.getElement('bfitToHeight');
  var fitToWidthHeight = goog.dom.getElement('bfitToWidthHeight');
  var fitTestRotate = goog.dom.getElement('bfitTestRotate');
  goog.events.listen(fitToWidth, goog.events.EventType.CLICK, function() {
    canvas.getViewbox().fitToWidth();
    canvas.draw();
  });
  goog.events.listen(fitToHeight, goog.events.EventType.CLICK, function() {
    canvas.getViewbox().fitToHeight();
    canvas.draw();
  });
  goog.events.listen(fitToWidthHeight, goog.events.EventType.CLICK, function() {
    canvas.getViewbox().fitToWidthHeight();
    canvas.draw();
  });
  goog.events.listen(fitTestRotate, goog.events.EventType.CLICK, function() {
    canvas.getViewbox().rotateRight();
    canvas.draw();
  });
  // canvas
  canvas.setBackgroundImage(url2, function() {
    canvas.setModeView();
  });  
};



function test7ctmDumpRestore() {
  var dump;
  var canvas = new xrx.drawing.Drawing(goog.dom.getElement('dumpRestore'));
  canvas.setBackgroundImage(url, function() {
    dump = canvas.getViewbox().ctmDump();
    dump[0]++;
    dump[1]++;
    dump[2]++;
    dump[3]++;
    dump[4]++;
    dump[5]++;
    canvas.getViewbox().ctmRestore(dump);
    canvas.draw();
  });
};



function test8rotate() {
  var canvas = new xrx.drawing.Drawing(goog.dom.getElement('rotate'));

  // form
  var form = goog.dom.getElement('frotate');
  var fixPoint = function() {
    var element = goog.dom.findNode(form, function(n) {
      return goog.dom.isElement(n) && n.checked;
    });
    return element.value;
  };

  // buttons
  var rotateLeft = goog.dom.getElement('brotateLeft');
  var rotateRight = goog.dom.getElement('brotateRight');
  goog.events.listen(rotateLeft, goog.events.EventType.CLICK, function() {
    canvas.getViewbox().rotate(-90, fixPoint());
    canvas.draw();
  });
  goog.events.listen(rotateRight, goog.events.EventType.CLICK, function() {
    canvas.getViewbox().rotate(90, fixPoint());
    canvas.draw();
  });

  // canvas
  canvas.setModeView();
  canvas.getViewbox().setZoomMax(2);
  canvas.getViewbox().setZoomMin(.4);
  canvas.getViewbox().getCTM().translate(20, 20);
  canvas.setBackgroundImage(url2);
};



function test12events() {
  var canvas1 = new xrx.drawing.Drawing(goog.dom.getElement('event1'));
  var canvas2 = new xrx.drawing.Drawing(goog.dom.getElement('event2'));
  canvas1.setBackgroundImage(url2, function() {
    canvas1.setModeView();
  });
  canvas2.setBackgroundImage(url2, function() {
    canvas2.setModeView();
  });
  // synchronize canvas2 with canvas1
  canvas1.eventViewboxChange = function() {
    var ctm = canvas1.getViewbox().getCTM();
    canvas2.getViewbox().setCTM(ctm);
    canvas2.draw();
  };
  // synchronize canvas1 with canvas2
  canvas2.eventViewboxChange = function() {
    var ctm = canvas2.getViewbox().getCTM();
    canvas1.getViewbox().setCTM(ctm);
    canvas1.draw();
  };
};

</script>

</body>
</html>